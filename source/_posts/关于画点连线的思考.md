---
title: 关于画点连线的思考
abbrlink: 4e9a8293
translate_title: thoughts-on-drawing-dotted-lines
date: 2021-03-20 19:00:23
tags:
  - 算法
---

## 前言

点和线是平面世界的基础，而画点连线更是基本操作。但是关于画点连线的方法，以及所能带来的思考，也是蛮有意思的。

在这片文章中，我会简单分析画点连线的基本方法。

## 一起来画画

### 基本的画点连线

在这个章节，我们会创建 canvas 并且在上面获取鼠标的点的位置，并且将点放入一个数组存储，用直线连接起来。为了方便操作，我们使用 PIXI 这个库来简化操作。

具体的细节步骤如下：

- 首先使用 PIXI 初始化应用，创建一个舞台
- 然后获取 app.view，在 canvas 上面绑定点击事件
- 获取点击事件的具体的坐标，在对应位置绘制圆，将其放入数组存储
- 循环遍历数组，将两点依次连线，绘制出图形。

便可以得出以下的效果
![](https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/20210327114145.png)
也可以在下面的环境中测试。

<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="kitety" data-slug-hash="xxgVzpW" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="xxgVzpW">
  <span>See the Pen <a href="https://codepen.io/kitety/pen/xxgVzpW">
  xxgVzpW</a> by kitety (<a href="https://codepen.io/kitety">@kitety</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

上述的 demo 基本的代码代码实现了，但是表述很生硬，就是一段一段的线段，没有任何的美感。假如我们想要的是折线图，这就已经实现目标了，但是如果我们想要的是有点美感的曲线呢？这应该怎么做呢？这个时候就该我们的贝赛尔曲线登场了。

### 贝赛尔曲线

在[维基百科](https://zh.wikipedia.org/wiki/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A)中，他是这么解释的：在数学的数值分析领域中，贝塞尔曲线（英语：Bézier curve）是计算机图形学中相当重要的参数曲线。

感觉还是不理解，详细的过程可以参考这篇[文章](https://github.com/hujiulong/blog/issues/1)

本节不是对贝塞尔曲线做专业分析，如果有需要请参考其他网站。

#### 二次贝赛尔曲线

大概的二次贝赛尔曲线就如下图所示：
![](https://z3.ax1x.com/2021/03/27/6x5yX4.gif)
二次贝塞尔曲线由三个点 P0,P1,P2 来确定，这些点也叫做控制点。我们需要三个点就可以绘制出一条二次贝赛尔曲线，在 canvas 中的对应的方法就是`quadraticCurveTo`这个方法。

#### 高次贝塞尔曲线

随着控制点的个数的增加，可以有三次，四次，N 次贝赛尔曲线，再次就不过多探讨。需要提示一下，绘制三次贝塞尔曲线的方法`bezierCurveTo`。

### 使用贝塞尔曲线绘制平滑曲线

要想绘制贝赛尔曲线，我们最简单的思路就是需要找准起点，控制点，终点。

最简单的就是假如我们有 A、B、C 三个点，我们需要绘制一条看似还算完美的曲线，我们应该怎么去思考呢？

我们会计算出 B 和 C 的中点 B1，以 A 为起点，B 为控制点，B1 为终点，最后将 B1、C 用直线链接。
![](https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/20210327121024.png)

当然这只是三个点的情况，我们如此循环往复就可以绘制足够多的点了。

#### 代码简析

```javascript
function drawLine() {
  // 绘制之前全部清除
  for (let ii = 0; ii < ss.length; ii++) {
    const bezier = ss[ii];
    app.stage.removeChild(bezier);
  }
  ss = [];

  let start = arr[0];
  if (arr.length === 2) {
    // 两个点直接连线
    drawBaseLine(start.pos, arr[1].pos);
  }
  if (arr.length >= 3) {
    for (let i = 1; i < arr.length; i++) {
      let control = arr[i];
      let end;
      if (!arr[i + 1]) {
        // 后面没有点了，将上一个贝塞尔曲线的终点和当前点连接
        drawBaseLine(start.pos, arr[i].pos);
        return;
      } else {
        // 将贝赛尔曲线终点设置为两点之间的中点
        end = getMiddle(arr[i], arr[i + 1]);
      }
      //  绘制贝赛尔曲线
      var bezier = new PIXI.Graphics();

      bezier.lineStyle(4, 0x1a7af8, 1);
      bezier.moveTo(start.pos.x, start.pos.y);
      bezier.quadraticCurveTo(
        control.pos.x,
        control.pos.y,
        end.pos.x,
        end.pos.y
      );
      bezier.endFill();
      start = end;
      app.stage.addChild(bezier);
      ss.push(bezier);
    }
  }
}
```

这样我们就可以尽量绘制出比较平滑的曲线了
![](https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/20210327123049.png)
也可以在下面的环境中测试。

<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="kitety" data-slug-hash="eYgZjOM" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="eYgZjOM">
  <span>See the Pen <a href="https://codepen.io/kitety/pen/eYgZjOM">
  eYgZjOM</a> by kitety (<a href="https://codepen.io/kitety">@kitety</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

上述的代码基本是实现了比较平滑的曲线，但是我们的还是会发现一些问题，就是在绘制的时候会出现画出来的线并没有经过点这种情况，看来革命尚未成功，同志仍需努力啊。
![](https://cdn.jsdelivr.net/gh/kitety/blog_img@master/img/20210327123211.png)

### 相似三角形
